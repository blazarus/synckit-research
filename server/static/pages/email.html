<html>
<head>
    <link rel="stylesheet" type="text/css" href="/static/stylesheets/style.css" /> 
    <script type="text/javascript" src="/static/javascripts/gears_init.js"></script>
    <script type="text/javascript" src="/static/javascripts/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="/static/javascripts/json-template.js"></script>
    <script type="text/javascript" src="/static/javascripts/sync.js"></script>
    <script type="text/javascript" src="/static/javascripts/template.js"></script>
    <script type="text/javascript" src="/static/javascripts/pretty_json.js"></script>

<script>
$(function() {
    console.info("Page Loaded");
    window.db = create_synckit();
    
    var remote_views = {
      "Messages":{
        "type":"queue",
        "field":"date",
        "order":"ASC"
      },
      "Tags":{
        "type":"set",
        "field":"id"
      }
    };
    
    // var state = window.db.get_state(remote_views);        
    var state = {};
    var endpoint = "http://localhost:8000/email/inbox";
    
    var params = {"queries":JSON.stringify(state)};    
    var dataspec = {
       "messages":"SELECT * FROM Messages;",
    };
    
    var template = "<div>{# This is a comment and will be removed from the output.}{.section messages}<h2>Mails</h2><table width='100%'>{.repeated section @}<tr><td>{from_email}</td><td>{subject}</td></tr>{.end}</table>{.or}<p><em>(No mails)</em></p>{.end}</div>";
    
    $.post(endpoint, params, function(data) {
        window.db.bulkload(data);
        var data = window.db.process_data_spec(dataspec);
        $('#templated').template(template);
        $('#templated').templateData(data);
        $('#templated').render();
    }, "json");
    
});
</script>
</head>
<body>
<div id="loading">
    <button onclick="window.db.reset();">Reset DB</button><button onclick="window.db.dump();">Dump DB</button>
</div>
<div id="debug">
    sd
</div>
<div id="templated">
</div>
</body>

</html>
